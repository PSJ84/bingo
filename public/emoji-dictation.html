<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ì´ëª¨ì§€ ë°›ì•„ì“°ê¸°</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/icon-192.svg">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --bg: #1a1a2e; --card: #16213e; --accent: #e94560; --accent2: #0f3460;
      --gold: #f5c518; --text: #eee; --green: #4ecca3; --orange: #ff9f43; --purple: #6c5ce7;
    }
    body {
      font-family: 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
      background: var(--bg); color: var(--text);
      min-height: 100dvh; display: flex; flex-direction: column; align-items: center;
    }
    h1 { font-size: 1.8rem; margin: 16px 0 8px; text-align: center; }
    .sub-text { color: #888; font-size: 0.85rem; margin: 4px 0; text-align: center; }
    .screen { display: none; width: 100%; max-width: 500px; padding: 16px; }
    .screen.active { display: flex; flex-direction: column; align-items: center; }

    .back-btn {
      background: none; border: 1px solid #555; color: #aaa;
      padding: 8px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9rem;
      margin: 8px 0; text-decoration: none; display: inline-block; text-align: center;
    }

    /* ë‚œì´ë„ ì„ íƒ */
    .diff-list { width: 100%; max-width: 360px; display: flex; flex-direction: column; gap: 10px; margin: 16px 0; }
    .diff-card {
      display: flex; align-items: center; gap: 14px; padding: 18px 20px;
      background: var(--card); border-radius: 16px; cursor: pointer;
      border: 2px solid #333; transition: all 0.15s;
    }
    .diff-card:hover { transform: scale(1.02); }
    .diff-card:active { transform: scale(0.97); }
    .diff-icon {
      width: 50px; height: 50px; border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; font-weight: 900; flex-shrink: 0;
    }
    .diff-info { flex: 1; }
    .diff-title { font-weight: 700; font-size: 1.1rem; margin-bottom: 2px; }
    .diff-desc { font-size: 0.8rem; color: #888; }
    .diff-arrow { color: #555; font-size: 1.2rem; }

    /* ê²Œì„ í™”ë©´ */
    .game-header {
      width: 100%; display: flex; justify-content: space-between; align-items: center;
      padding: 8px 0; margin-bottom: 8px;
    }
    .game-counter { font-size: 0.9rem; color: #888; font-weight: 700; }
    .game-score { font-size: 1rem; color: var(--gold); font-weight: 700; }

    .emoji-display {
      font-size: 7rem; margin: 20px 0; padding: 24px;
      background: rgba(108,92,231,0.08); border-radius: 30px;
      animation: emojiPop 0.4s ease;
    }
    @keyframes emojiPop { 0%{transform:scale(0.5);opacity:0} 60%{transform:scale(1.1)} 100%{transform:scale(1);opacity:1} }

    .hint-text {
      font-size: 1rem; color: var(--orange); font-weight: 700; margin: 8px 0;
      min-height: 24px; text-align: center;
    }

    .answer-input {
      width: 100%; max-width: 300px; padding: 16px; margin: 12px 0;
      border: 3px solid #444; border-radius: 14px; font-size: 1.6rem;
      font-weight: 700; text-align: center; background: var(--card);
      color: var(--text); outline: none;
    }
    .answer-input:focus { border-color: var(--purple); }
    .answer-input.correct { border-color: var(--green); background: rgba(78,204,163,0.1); }
    .answer-input.wrong { border-color: var(--accent); background: rgba(233,69,96,0.1); }

    .submit-btn {
      padding: 14px 60px; background: var(--green); color: #000;
      font-weight: 800; font-size: 1.2rem; border: none; border-radius: 14px;
      cursor: pointer; margin: 8px 0; transition: transform 0.15s;
    }
    .submit-btn:active { transform: scale(0.95); }
    .submit-btn:disabled { opacity: 0.4; cursor: default; }

    .next-btn {
      padding: 14px 48px; background: var(--purple); color: #fff;
      font-weight: 800; font-size: 1.1rem; border: none; border-radius: 14px;
      cursor: pointer; margin: 8px 0; transition: transform 0.15s;
    }
    .next-btn:active { transform: scale(0.95); }

    .correct-answer {
      font-size: 1.4rem; font-weight: 900; color: var(--green);
      margin: 8px 0; padding: 12px 24px;
      background: rgba(78,204,163,0.1); border-radius: 12px;
    }

    /* ê²°ê³¼ í™”ë©´ */
    .result-emoji { font-size: 4rem; margin: 16px 0; }
    .result-title { font-size: 1.8rem; font-weight: 900; color: var(--gold); }
    .result-detail { font-size: 1.2rem; color: #ccc; margin: 12px 0; }
    .result-stars { font-size: 2rem; margin: 8px 0; }

    .result-list { width: 100%; max-width: 360px; margin: 16px 0; }
    .result-item {
      display: flex; align-items: center; gap: 10px; padding: 10px 14px;
      background: var(--card); border-radius: 12px; margin-bottom: 6px;
    }
    .result-item .ri-emoji { font-size: 1.6rem; }
    .result-item .ri-word { flex: 1; font-weight: 700; font-size: 1rem; }
    .result-item .ri-mark { font-size: 1.2rem; }

    .result-btns { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-top: 16px; }
    .result-btn {
      padding: 14px 28px; border: none; border-radius: 14px; font-size: 1rem;
      font-weight: 800; cursor: pointer;
    }
    .result-btn.primary { background: var(--green); color: #000; }
    .result-btn.secondary { background: var(--card); color: var(--text); border: 1px solid #555; }

    /* í”¼ë“œë°± ì˜¤ë²„ë ˆì´ */
    .feedback-overlay {
      position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center;
      pointer-events: none; animation: feedbackPop 0.8s forwards;
    }
    .feedback-msg {
      font-size: 1.6rem; font-weight: 900; padding: 20px 40px; border-radius: 20px;
      animation: feedbackScale 0.5s ease;
    }
    .feedback-correct { background: rgba(78,204,163,0.95); color: #000; }
    .feedback-wrong { background: rgba(233,69,96,0.95); color: #fff; }
    @keyframes feedbackPop { 0%{opacity:1}70%{opacity:1}100%{opacity:0} }
    @keyframes feedbackScale { 0%{transform:scale(0.5)}50%{transform:scale(1.1)}100%{transform:scale(1)} }

    .toast {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: var(--accent); color: #fff; padding: 12px 24px; border-radius: 12px;
      font-weight: 600; z-index: 200; animation: toastIn 0.3s, toastOut 0.3s 2s forwards;
    }
    @keyframes toastIn { from { opacity:0; transform:translateX(-50%) translateY(20px); } }
    @keyframes toastOut { to { opacity:0; transform:translateX(-50%) translateY(20px); } }

    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>

  <!-- ë‚œì´ë„ ì„ íƒ -->
  <div id="screen-select" class="screen active">
    <h1>ğŸ–¼ï¸ ì´ëª¨ì§€ ë°›ì•„ì“°ê¸°</h1>
    <p class="sub-text">ê·¸ë¦¼ì„ ë³´ê³  ì´ë¦„ì„ ë§ì¶°ë³´ì„¸ìš”!</p>

    <div class="diff-list">
      <div class="diff-card" onclick="startGame('easy')" style="border-color:#4ecca3;">
        <div class="diff-icon" style="background:rgba(78,204,163,0.15);color:#4ecca3;">ğŸŒ±</div>
        <div class="diff-info">
          <div class="diff-title">ì‰¬ì›€</div>
          <div class="diff-desc">2ê¸€ì ë‹¨ì–´ (ì‚¬ê³¼, í¬ë„, ìš°ì‚°...)</div>
        </div>
        <span class="diff-arrow">â†’</span>
      </div>

      <div class="diff-card" onclick="startGame('normal')" style="border-color:#f5c518;">
        <div class="diff-icon" style="background:rgba(245,197,24,0.15);color:#f5c518;">â­</div>
        <div class="diff-info">
          <div class="diff-title">ì¤‘ê°„</div>
          <div class="diff-desc">3ê¸€ì ë‹¨ì–´ (ê°•ì•„ì§€, ë¹„í–‰ê¸°...)</div>
        </div>
        <span class="diff-arrow">â†’</span>
      </div>

      <div class="diff-card" onclick="startGame('hard')" style="border-color:#e94560;">
        <div class="diff-icon" style="background:rgba(233,69,96,0.15);color:#e94560;">ğŸ”¥</div>
        <div class="diff-info">
          <div class="diff-title">ì–´ë ¤ì›€</div>
          <div class="diff-desc">4ê¸€ì ì´ìƒ (í•´ë°”ë¼ê¸°, í…”ë ˆë¹„ì „...)</div>
        </div>
        <span class="diff-arrow">â†’</span>
      </div>

      <div class="diff-card" onclick="startGame('random')" style="border-color:#6c5ce7;">
        <div class="diff-icon" style="background:rgba(108,92,231,0.15);color:#6c5ce7;">ğŸ²</div>
        <div class="diff-info">
          <div class="diff-title">ëœë¤</div>
          <div class="diff-desc">ëª¨ë“  ë‚œì´ë„ ì„ì–´ì„œ!</div>
        </div>
        <span class="diff-arrow">â†’</span>
      </div>
    </div>

    <a href="/" class="back-btn">ğŸ  í™ˆìœ¼ë¡œ</a>
  </div>

  <!-- ê²Œì„ í™”ë©´ -->
  <div id="screen-game" class="screen">
    <div class="game-header">
      <button class="back-btn" onclick="backToSelect()" style="margin:0;padding:6px 14px;">â† ëª©ë¡</button>
      <span class="game-counter" id="game-counter">1 / 10</span>
      <span class="game-score" id="game-score">â­ 0</span>
    </div>

    <div class="emoji-display" id="emoji-display">ğŸ</div>

    <div class="hint-text" id="hint-text"></div>

    <input type="text" class="answer-input" id="answer-input" placeholder="ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”"
           autocomplete="off" autocapitalize="off" spellcheck="false" maxlength="10">

    <button class="submit-btn" id="btn-submit" onclick="submitAnswer()">í™•ì¸!</button>
  </div>

  <!-- ê²°ê³¼ í™”ë©´ -->
  <div id="screen-result" class="screen">
    <div class="result-emoji" id="result-emoji">ğŸ†</div>
    <div class="result-title" id="result-title">ì˜í–ˆì–´ìš”!</div>
    <div class="result-detail" id="result-detail">10 / 10 ì •ë‹µ!</div>
    <div class="result-stars" id="result-stars">â­â­â­</div>

    <div class="result-list" id="result-list"></div>

    <div class="result-btns">
      <button class="result-btn secondary" onclick="backToSelect()">ë‚œì´ë„ ì„ íƒ</button>
      <button class="result-btn primary" onclick="retryGame()">ë‹¤ì‹œ í•˜ê¸° ğŸ”„</button>
    </div>
    <a href="/" class="back-btn" style="margin-top:12px;">ğŸ  í™ˆìœ¼ë¡œ</a>
  </div>

  <script>
    // â”€â”€ ë‹¨ì–´ ë°ì´í„° â”€â”€
    const WORDS = {
      easy: [
        {emoji:'ğŸ',word:'ì‚¬ê³¼'},{emoji:'ğŸ‡',word:'í¬ë„'},{emoji:'ğŸŒ‚',word:'ìš°ì‚°'},
        {emoji:'âš½',word:'ì¶•êµ¬'},{emoji:'â˜ï¸',word:'êµ¬ë¦„'},{emoji:'ğŸŒŠ',word:'ë°”ë‹¤'},
        {emoji:'ğŸ•',word:'í”¼ì'},{emoji:'ğŸ‰',word:'ìˆ˜ë°•'},{emoji:'ğŸ‹',word:'ë ˆëª¬'},
        {emoji:'ğŸ“',word:'ë”¸ê¸°'},{emoji:'ğŸ¥•',word:'ë‹¹ê·¼'},{emoji:'ğŸšŒ',word:'ë²„ìŠ¤'},
        {emoji:'ğŸˆ',word:'í’ì„ '},{emoji:'ğŸ¦',word:'ì‚¬ì'},{emoji:'ğŸ¦‹',word:'ë‚˜ë¹„'},
        {emoji:'ğŸ‘Ÿ',word:'ì‹ ë°œ'},{emoji:'ğŸ§¢',word:'ëª¨ì'},{emoji:'ğŸ’',word:'ê°€ë°©'},
        {emoji:'âœï¸',word:'ì—°í•„'},{emoji:'ğŸ¥›',word:'ìš°ìœ '},{emoji:'â˜€ï¸',word:'íƒœì–‘'},
        {emoji:'ğŸš‚',word:'ê¸°ì°¨'},{emoji:'ğŸ³',word:'ê³ ë˜'},{emoji:'ğŸ§',word:'í­ê·„'},
        {emoji:'ğŸ¦’',word:'ê¸°ë¦°'},{emoji:'ğŸŠ',word:'ì•…ì–´'},{emoji:'ğŸ™',word:'ë¬¸ì–´'},
        {emoji:'ğŸ',word:'ì„ ë¬¼'},{emoji:'ğŸ§€',word:'ì¹˜ì¦ˆ'},{emoji:'ğŸµ',word:'ë…¸ë˜'},
      ],
      normal: [
        {emoji:'ğŸ•',word:'ê°•ì•„ì§€'},{emoji:'ğŸ±',word:'ê³ ì–‘ì´'},{emoji:'ğŸ˜',word:'ì½”ë¼ë¦¬'},
        {emoji:'ğŸ¸',word:'ê°œêµ¬ë¦¬'},{emoji:'ğŸ¢',word:'ê±°ë¶ì´'},{emoji:'ğŸŒ',word:'ë°”ë‚˜ë‚˜'},
        {emoji:'ğŸŠ',word:'ì˜¤ë Œì§€'},{emoji:'ğŸ”',word:'í–„ë²„ê±°'},{emoji:'ğŸŒˆ',word:'ë¬´ì§€ê°œ'},
        {emoji:'âœˆï¸',word:'ë¹„í–‰ê¸°'},{emoji:'ğŸš—',word:'ìë™ì°¨'},{emoji:'ğŸš²',word:'ìì „ê±°'},
        {emoji:'ğŸ¹',word:'í”¼ì•„ë…¸'},{emoji:'ğŸ‚',word:'ì¼€ì´í¬'},{emoji:'ğŸ“·',word:'ì¹´ë©”ë¼'},
        {emoji:'ğŸŸ',word:'ë¬¼ê³ ê¸°'},{emoji:'ğŸŒ½',word:'ì˜¥ìˆ˜ìˆ˜'},{emoji:'ğŸ¬',word:'ëŒê³ ë˜'},
        {emoji:'ğŸ–¥ï¸',word:'ì»´í“¨í„°'},{emoji:'ğŸ¦œ',word:'ì•µë¬´ìƒˆ'},{emoji:'ğŸš€',word:'ìš°ì£¼ì„ '},
        {emoji:'ğŸ©',word:'ë„ë„ˆì¸ '},{emoji:'ğŸ«',word:'ìœ ì¹˜ì›'},{emoji:'ğŸ¡',word:'ê´€ëŒì°¨'},
      ],
      hard: [
        {emoji:'ğŸŒ»',word:'í•´ë°”ë¼ê¸°'},{emoji:'ğŸ»',word:'ë°”ì´ì˜¬ë¦°'},{emoji:'ğŸ“º',word:'í…”ë ˆë¹„ì „'},
        {emoji:'ğŸš',word:'í—¬ë¦¬ì½¥í„°'},{emoji:'ğŸ„',word:'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'},{emoji:'ğŸ¦',word:'ì•„ì´ìŠ¤í¬ë¦¼'},
        {emoji:'ğŸ ',word:'íšŒì „ëª©ë§ˆ'},{emoji:'ğŸ…',word:'ì‚°íƒ€í´ë¡œìŠ¤'},{emoji:'ğŸ¢',word:'ë¡¤ëŸ¬ì½”ìŠ¤í„°'},
        {emoji:'ğŸ–ï¸',word:'í•´ìˆ˜ìš•ì¥'},{emoji:'ğŸ',word:'ìƒì¼ì„ ë¬¼'},{emoji:'ğŸš’',word:'ì†Œë°©ìë™ì°¨'},
      ],
    };

    const TOTAL_PROBLEMS = 10;
    const ENCOURAGE = ['ì˜í–ˆì–´ìš”! ğŸ‘','ëŒ€ë‹¨í•´ìš”! â­','ë©‹ì ¸ìš”! ğŸ‰','ì •ë‹µì´ì—ìš”! ğŸ˜Š','ìµœê³ ì˜ˆìš”! ğŸ§ ','ì™„ë²½í•´ìš”! ğŸ’¯','ì²œì¬! ğŸ†'];
    const ENCOURAGE_WRONG = ['ë‹¤ì‹œ í•´ë´ìš”! ğŸ˜Š','ì²œì²œíˆ ìƒê°í•´ë´ìš”! ğŸ¤”','í˜ë‚´ìš”! ğŸ’ª','í•  ìˆ˜ ìˆì–´ìš”! ğŸŒŸ'];

    let currentDifficulty = 'easy';
    let problems = [];
    let currentIdx = 0;
    let attempts = 0;
    let score = 0;
    let results = []; // {emoji, word, correct}
    let answered = false;

    // â”€â”€ íš¨ê³¼ìŒ â”€â”€
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let audioCtx = null;
    function getAudioCtx() { if (!audioCtx) audioCtx = new AudioCtx(); if (audioCtx.state === 'suspended') audioCtx.resume(); return audioCtx; }
    function playCorrect() {
      const ctx = getAudioCtx(), t = ctx.currentTime;
      [523,659,784].forEach((f,i) => {
        const o = ctx.createOscillator(), g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination); o.type = 'sine';
        o.frequency.setValueAtTime(f, t + i * 0.1);
        g.gain.setValueAtTime(0.25, t + i * 0.1);
        g.gain.exponentialRampToValueAtTime(0.01, t + i * 0.1 + 0.25);
        o.start(t + i * 0.1); o.stop(t + i * 0.1 + 0.25);
      });
    }
    function playWrong() {
      const ctx = getAudioCtx(), t = ctx.currentTime;
      const o = ctx.createOscillator(), g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination); o.type = 'square';
      o.frequency.setValueAtTime(200, t);
      g.gain.setValueAtTime(0.12, t);
      g.gain.exponentialRampToValueAtTime(0.01, t + 0.25);
      o.start(t); o.stop(t + 0.25);
    }
    function playFanfare() {
      const ctx = getAudioCtx(), t = ctx.currentTime;
      [[523,659,784],[587,740,880],[523,659,784,1047]].forEach((chord,ci) => {
        chord.forEach(f => {
          const o = ctx.createOscillator(), g = ctx.createGain();
          o.connect(g); g.connect(ctx.destination); o.type = 'sine';
          o.frequency.setValueAtTime(f, t + ci * 0.3);
          g.gain.setValueAtTime(0.12, t + ci * 0.3);
          g.gain.exponentialRampToValueAtTime(0.01, t + ci * 0.3 + 0.5);
          o.start(t + ci * 0.3); o.stop(t + ci * 0.3 + 0.5);
        });
      });
    }

    // â”€â”€ ìœ í‹¸ â”€â”€
    function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
    function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function showFeedback(correct, msg) {
      const overlay = document.createElement('div');
      overlay.className = 'feedback-overlay';
      const m = document.createElement('div');
      m.className = 'feedback-msg ' + (correct ? 'feedback-correct' : 'feedback-wrong');
      m.textContent = msg;
      overlay.appendChild(m);
      document.body.appendChild(overlay);
      setTimeout(() => overlay.remove(), 800);
    }

    // â”€â”€ ê²Œì„ ì‹œì‘ â”€â”€
    function startGame(difficulty) {
      getAudioCtx();
      currentDifficulty = difficulty;
      currentIdx = 0;
      score = 0;
      results = [];

      let pool;
      if (difficulty === 'random') {
        pool = [...WORDS.easy, ...WORDS.normal, ...WORDS.hard];
      } else {
        pool = [...WORDS[difficulty]];
      }
      shuffle(pool);
      problems = pool.slice(0, TOTAL_PROBLEMS);

      showScreen('screen-game');
      loadProblem();
    }

    function loadProblem() {
      const p = problems[currentIdx];
      attempts = 0;
      answered = false;

      document.getElementById('game-counter').textContent = `${currentIdx + 1} / ${TOTAL_PROBLEMS}`;
      document.getElementById('game-score').textContent = `â­ ${score}`;
      document.getElementById('emoji-display').textContent = p.emoji;
      document.getElementById('hint-text').textContent = '';
      document.getElementById('btn-submit').style.display = '';
      document.getElementById('btn-submit').disabled = false;

      const input = document.getElementById('answer-input');
      input.value = '';
      input.className = 'answer-input';
      input.disabled = false;
      input.placeholder = `${p.word.length}ê¸€ì`;
      input.focus();
    }

    function submitAnswer() {
      if (answered) return;
      const input = document.getElementById('answer-input');
      const userAnswer = input.value.trim();
      const correct = problems[currentIdx];

      if (!userAnswer) return;

      if (userAnswer === correct.word) {
        // ì •ë‹µ!
        answered = true;
        score++;
        results.push({ emoji: correct.emoji, word: correct.word, correct: true });
        playCorrect();
        showFeedback(true, pick(ENCOURAGE));

        input.className = 'answer-input correct';
        input.disabled = true;
        document.getElementById('game-score').textContent = `â­ ${score}`;
        document.getElementById('btn-submit').style.display = 'none';
        document.getElementById('hint-text').innerHTML = `<span style="color:var(--green)">ì •ë‹µ! ${correct.emoji} = ${correct.word}</span>`;

        if (currentIdx + 1 >= TOTAL_PROBLEMS) {
          setTimeout(() => showResult(), 1000);
        } else {
          setTimeout(() => { currentIdx++; loadProblem(); }, 1000);
        }
      } else {
        // ì˜¤ë‹µ
        attempts++;
        playWrong();
        input.className = 'answer-input wrong';
        setTimeout(() => { input.className = 'answer-input'; }, 500);

        if (attempts === 1) {
          showFeedback(false, pick(ENCOURAGE_WRONG));
          document.getElementById('hint-text').textContent = `ğŸ’¡ ${correct.word.length}ê¸€ì ë‹¨ì–´ì˜ˆìš”!`;
        } else if (attempts === 2) {
          showFeedback(false, 'í•œ ë²ˆ ë” ë„ì „! ğŸ’ª');
          // ì²« ê¸€ì íŒíŠ¸
          document.getElementById('hint-text').textContent = `ğŸ’¡ "${correct.word[0]}"ìœ¼ë¡œ ì‹œì‘í•´ìš”!`;
        } else {
          // 3ë²ˆ í‹€ë¦¼ â†’ ì •ë‹µ ê³µê°œ
          answered = true;
          results.push({ emoji: correct.emoji, word: correct.word, correct: false });
          showFeedback(false, `ì •ë‹µì€ "${correct.word}"ì´ì—ìš”!`);

          input.className = 'answer-input wrong';
          input.value = correct.word;
          input.disabled = true;
          document.getElementById('btn-submit').style.display = 'none';
          document.getElementById('hint-text').innerHTML = `<span style="color:var(--accent)">ì •ë‹µ: ${correct.emoji} = ${correct.word}</span>`;

          if (currentIdx + 1 >= TOTAL_PROBLEMS) {
            setTimeout(() => showResult(), 1500);
          } else {
            setTimeout(() => { currentIdx++; loadProblem(); }, 1500);
          }
        }

        input.value = '';
        input.focus();
      }
    }

    function showResult() {
      playFanfare();
      showScreen('screen-result');

      const pct = Math.round((score / TOTAL_PROBLEMS) * 100);
      let emoji, title;
      if (pct === 100) { emoji = 'ğŸ†'; title = 'ì™„ë²½í•´ìš”!'; }
      else if (pct >= 80) { emoji = 'ğŸ‰'; title = 'ì˜í–ˆì–´ìš”!'; }
      else if (pct >= 50) { emoji = 'â­'; title = 'ì¢‹ì•„ìš”!'; }
      else { emoji = 'ğŸ’ª'; title = 'ë‹¤ì‹œ ë„ì „í•´ë´ìš”!'; }

      document.getElementById('result-emoji').textContent = emoji;
      document.getElementById('result-title').textContent = title;
      document.getElementById('result-detail').textContent = `${score} / ${TOTAL_PROBLEMS} ì •ë‹µ! (${pct}%)`;

      const starCount = pct === 100 ? 3 : pct >= 70 ? 2 : pct >= 40 ? 1 : 0;
      document.getElementById('result-stars').textContent = 'â­'.repeat(starCount) + 'â˜†'.repeat(3 - starCount);

      const list = document.getElementById('result-list');
      list.innerHTML = '';
      results.forEach(r => {
        list.innerHTML += `<div class="result-item">
          <span class="ri-emoji">${r.emoji}</span>
          <span class="ri-word">${r.word}</span>
          <span class="ri-mark">${r.correct ? 'âœ…' : 'âŒ'}</span>
        </div>`;
      });

      // ê½ƒê°€ë£¨ íš¨ê³¼ (100%ì¼ ë•Œ)
      if (pct === 100) spawnConfetti();
    }

    function spawnConfetti() {
      const colors = ['#e94560','#4ecca3','#f5c518','#6c5ce7','#ff9f43'];
      for (let i = 0; i < 30; i++) {
        const c = document.createElement('div');
        c.style.cssText = `position:fixed;top:-10px;left:${Math.random()*100}%;width:10px;height:10px;
          background:${colors[i%colors.length]};border-radius:50%;z-index:300;pointer-events:none;
          animation:confettiFall ${1+Math.random()*2}s linear ${Math.random()*0.5}s forwards;`;
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 4000);
      }
    }

    function backToSelect() { showScreen('screen-select'); }
    function retryGame() { startGame(currentDifficulty); }

    // ì—”í„°í‚¤ë¡œ ì œì¶œ
    document.getElementById('answer-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !answered) submitAnswer();
    });
  </script>
</body>
</html>
